{
    "name": "install-docker-compose",
    "content": "#!/bin/bash\n#\n# 安装 Docker 和 Docker Compose 脚本\n# 支持 Ubuntu/Debian 和 CentOS/RHEL 系统\n#\n\nset -e\n\n# 颜色输出\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\n# 日志函数\nlog_info() {\n    echo -e \"${GREEN}[INFO]${NC} $1\"\n}\n\nlog_warn() {\n    echo -e \"${YELLOW}[WARN]${NC} $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\n# 检测操作系统类型\ndetect_os() {\n    if [ -f /etc/os-release ]; then\n        . /etc/os-release\n        OS=$ID\n        VERSION=$VERSION_ID\n    else\n        log_error \"无法检测操作系统类型\"\n        exit 1\n    fi\n    log_info \"检测到操作系统: $OS $VERSION\"\n}\n\n# 卸载旧版本\nuninstall_old() {\n    log_info \"检查并卸载旧版本 Docker...\"\n    if command -v docker &> /dev/null; then\n        case $OS in\n            ubuntu|debian)\n                sudo apt-get remove -y docker docker-engine docker.io containerd runc 2>/dev/null || true\n                ;;\n            centos|rhel|fedora)\n                sudo yum remove -y docker docker-client docker-client-latest docker-common \\\n                    docker-latest docker-latest-logrotate docker-logrotate docker-engine 2>/dev/null || true\n                ;;\n        esac\n        log_info \"旧版本 Docker 已卸载\"\n    else\n        log_info \"未检测到旧版本 Docker\"\n    fi\n}\n\n# 安装 Docker\ninstall_docker() {\n    log_info \"开始安装 Docker...\"\n\n    case $OS in\n        ubuntu|debian)\n            # Ubuntu/Debian 安装\n            sudo apt-get update\n            sudo apt-get install -y \\\n                ca-certificates \\\n                curl \\\n                gnupg \\\n                lsb-release\n\n            # 添加 Docker 官方 GPG 密钥\n            sudo mkdir -p /etc/apt/keyrings\n            curl -fsSL https://download.docker.com/linux/$OS/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\n\n            # 设置 Docker 仓库\n            echo \\\n                \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/$OS \\\n                $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n\n            # 安装 Docker\n            sudo apt-get update\n            sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n\n            # 启动 Docker\n            sudo systemctl start docker\n            sudo systemctl enable docker\n\n            # 添加当前用户到 docker 组\n            sudo usermod -aG docker $USER 2>/dev/null || true\n            log_warn \"请重新登录或执行 'newgrp docker' 以使用户组生效\"\n\n            ;;\n\n        centos|rhel|fedora)\n            # CentOS/RHEL 安装\n            sudo yum install -y yum-utils\n            sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\n            # 安装 Docker\n            sudo yum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n\n            # 启动 Docker\n            sudo systemctl start docker\n            sudo systemctl enable docker\n\n            # 添加当前用户到 docker 组\n            sudo usermod -aG docker $USER 2>/dev/null || true\n            log_warn \"请重新登录或执行 'newgrp docker' 以使用户组生效\"\n\n            ;;\n\n        *)\n            log_error \"不支持的操作系统: $OS\"\n            exit 1\n            ;;\n    esac\n\n    log_info \"Docker 安装完成\"\n}\n\n# 验证安装\nverify_installation() {\n    log_info \"验证安装...\"\n\n    # 检查 Docker\n    if command -v docker &> /dev/null; then\n        docker_version=$(docker --version)\n        log_info \"Docker 已安装: $docker_version\"\n\n        # 测试 Docker 运行\n        sudo docker run --rm hello-world &> /dev/null\n        if [ $? -eq 0 ]; then\n            log_info \"Docker 运行正常\"\n        else\n            log_warn \"Docker 测试运行失败，可能需要手动配置\"\n        fi\n    else\n        log_error \"Docker 安装失败\"\n        exit 1\n    fi\n\n    # 检查 Docker Compose\n    if command -v docker-compose &> /dev/null; then\n        compose_version=$(docker-compose --version)\n        log_info \"Docker Compose 已安装: $compose_version\"\n    elif docker compose version &> /dev/null; then\n        compose_plugin_version=$(docker compose version)\n        log_info \"Docker Compose 插件已安装: $compose_plugin_version\"\n    else\n        log_error \"Docker Compose 安装失败\"\n        exit 1\n    fi\n}\n\n# 安装完成\ninstall_complete() {\n    echo \"\"\n    log_info \"==========================================\"\n    log_info \"Docker 和 Docker Compose 安装完成！\"\n    log_info \"==========================================\"\n    echo \"\"\n    log_info \"常用命令:\"\n    echo \"  docker --version           # 查看 Docker 版本\"\n    echo \"  docker ps                  # 查看运行中的容器\"\n    echo \"  docker images              # 查看镜像列表\"\n    echo \"  docker-compose up -d       # 启动服务\"\n    echo \"  docker compose version     # 查看 Docker Compose 版本\"\n    echo \"\"\n    log_warn \"注意: 请重新登录或执行 'newgrp docker' 以使 docker 用户组生效\"\n}\n\n# 主函数\nmain() {\n    echo \"\"\n    log_info \"开始安装 Docker 和 Docker Compose...\"\n    echo \"\"\n\n    detect_os\n    uninstall_old\n    install_docker\n    verify_installation\n    install_complete\n\n    echo \"\"\n    log_info \"安装成功！\"\n}\n\n# 执行主函数\nmain"
}
