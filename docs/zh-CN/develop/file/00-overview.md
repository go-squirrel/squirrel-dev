# 文件管理模块设计概述

## 1. 模块定位

文件管理模块分为两个独立页面，满足不同使用场景：

| 页面 | 路由 | 定位 | 传输模式 |
|------|------|------|----------|
| **文件管理** | `/files` | 实时文件操作工具 | 流式代理 |
| **文件传输中心** | `/transfer` | 文件分发平台（Phase 3） | 中转存储 |

## 2. 整体架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Frontend (Vue3)                                     │
│  ├── /files      - 文件管理页面（实时操作）                                   │
│  └── /transfer   - 文件传输中心（Phase 3）                                    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │ HTTP
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                     squ-apiserver (代理层)                                    │
│  ├── 权限验证                                                                 │
│  ├── 请求路由转发                                                             │
│  └── 流式代理（上传/下载）                                                    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │ mTLS
              ┌─────────────────────┼─────────────────────┐
              ▼                     ▼                     ▼
┌──────────────────────┐ ┌──────────────────────┐ ┌──────────────────────┐
│   squ-agent (主机1)   │ │   squ-agent (主机2)   │ │   squ-agent (主机N)   │
├──────────────────────┤ ├──────────────────────┤ ├──────────────────────┤
│ • 文件系统操作        │ │ • 文件系统操作        │ │ • 文件系统操作        │
│ • 沙箱路径限制        │ │ • 沙箱路径限制        │ │ • 沙箱路径限制        │
│ • 权限校验           │ │ • 权限校验           │ │ • 权限校验           │
└──────────────────────┘ └──────────────────────┘ └──────────────────────┘
```

## 3. 功能范围

### 3.1 文件管理页面（Phase 1-2）

| 功能 | Phase | 说明 |
|------|-------|------|
| 目录浏览 | 1 | 列出目录内容，支持排序筛选 |
| 文件读取 | 1 | 读取文件内容（文本预览） |
| 文件下载 | 1 | 下载文件（流式传输） |
| 安全校验 | 1 | 路径沙箱限制 |
| 文件写入 | 2 | 保存文件内容 |
| 文件上传 | 2 | 上传小文件（< 50MB） |
| 创建/删除 | 2 | 创建文件/目录，删除操作 |
| 在线编辑 | 2 | 代码编辑器 |
| 文件搜索 | 2 | 搜索文件名 |

### 3.2 文件传输中心（Phase 3）

| 功能 | 说明 |
|------|------|
| 大文件上传 | 支持断点续传 |
| 文件库管理 | 存储已上传文件 |
| 多节点分发 | 一键分发到多台服务器 |
| 传输记录 | 历史记录和进度追踪 |
| 版本管理 | 文件版本保留 |

## 4. 开发阶段规划

```
Phase 1: Agent 核心功能
├── 01-agent-core.md    # 目录浏览 + 文件读取 + 安全校验
└── 完成后可独立测试

Phase 2: Agent 写入功能
├── 02-agent-write.md   # 文件写入 + 上传 + 创建删除
└── 完成后 Agent 端功能完整

Phase 3: APIServer 代理
├── 03-apiserver-proxy.md  # 请求转发 + 流式代理
└── 完成后可通过 APIServer 访问

Phase 4: 前端页面
├── 04-frontend-filemanager.md  # 文件管理页面
└── 完成后用户可用

Phase 5: 文件传输中心（可选）
├── 05-transfer-center.md  # 大文件 + 多节点分发
└── 按需开发
```

## 5. 文档索引

| 文档 | 内容 | 开发阶段 |
|------|------|----------|
| [01-agent-core.md](./01-agent-core.md) | Agent 核心实现 | Phase 1 |
| [02-agent-write.md](./02-agent-write.md) | Agent 写入操作 | Phase 2 |
| [03-apiserver-proxy.md](./03-apiserver-proxy.md) | APIServer 代理 | Phase 3 |
| [04-frontend-filemanager.md](./04-frontend-filemanager.md) | 前端页面 | Phase 4 |
| [05-transfer-center.md](./05-transfer-center.md) | 文件传输中心 | Phase 5 |

## 6. 技术栈

- **后端**：Go + Gin + GORM
- **前端**：Vue 3 + TypeScript + Monaco Editor
- **传输**：HTTP 流式传输
- **安全**：路径沙箱 + mTLS

## 7. 相关参考

- 项目目录结构：`docs/zh-CN/guide/directory-structure.md`
- Agent 加入设计：`docs/zh-CN/develop/agent_join_design.md`
- 监控模块设计：`docs/zh-CN/develop/monitor/01-monitor.md`
